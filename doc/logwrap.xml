<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- The root element must be called logWrap which starts the -->
<!-- configuration for the LogWrapper.                        -->
<logWrap>

  <!-- Additional 3rd party EventHandler's can be added to    -->
  <!-- any python system path.  This element enables a user   -->
  <!-- to place handlers in additional directories.  There    -->
  <!-- can be zero or more of these elements.                 -->
  <handlerDirectory dir="/tmp"/>

  <!-- You may optionally specify one or more error handlers  -->
  <!-- that will handle errors generated by the processing of -->
  <!-- events.  I.e. if any of the handlers in your the rules -->
  <!-- you define below fails, this handler can be used to    -->
  <!-- handle that event.                                     -->
  <errorHandler type="Print"/>
  
  <!-- The next element must be one or more logEncapsulator   -->
  <!-- elements.  Each encapsulator defines a set of rules    -->
  <!-- that are associated with one or more log files.  Each  -->
  <!-- logEncapsulator element must have a name attribute to  -->
  <!-- identify the encapsulator.                             -->
  <logEncapsulator name="Test Monitor">

    <!-- Within the logEncapsulator element, one or more      -->
    <!-- logFile elements must be specified to indicate the   -->
    <!-- log file(s) that should be monitored.  The logFile   -->
    <!-- element must have a file attribute that points to    -->
    <!-- the file on the local filesystem.  An optional       -->
    <!-- second argument can be specified that indicates      -->
    <!-- whether the file should be tracked.  A value of 1    -->
    <!-- will track the file, while a value of 0 will disable -->
    <!-- tracking.  The default is to track.                  -->
    <logFile file="test1-1"/>
    <logFile file="test1-2" track="0"/>

    <!-- Following the logFile elements, one or more rule     -->
    <!-- elements must be specified.  An optional quick       -->
    <!-- attribute may be specified to indicate if rule       -->
    <!-- processing should stop if a match occurs.  A value   -->
    <!-- of 1 stops processing, and 0 permits multiple rules  -->
    <!-- to match.  If the attribute is not specified, the    -->
    <!-- default is 0.                                        -->
    <rule quick="0">

      <!-- Each rule must have a regexp element that is used  -->
      <!-- to search for matches in the log file(s).  Each    -->
      <!-- regexp is a python regular expression and can be   -->
      <!-- specified as part of a CDATA block.                -->
      <regexp>pete</regexp>
      
      <!-- Each rule must have one or more handler elements   -->
      <!-- that specifies the action to take when a rule is   -->
      <!-- is matched.  If more than one handler is specified -->
      <!-- they are chained together in the order they appear -->
      <!-- in the file. Each handler element must have a type -->
      <!-- attribute that indicates the type of handler.  All -->
      <!-- handlers are different and each has its own set of -->
      <!-- additional attributes that must be specified.  See -->
      <!-- the accompanying documentation for details on the  -->
      <!-- various handlers.  In this next case, the print    -->
      <!-- handler requires a file attribute specifying the   -->
      <!-- location where output should be sent.              -->
      <handler type="Print" file="stdout"/>
    </rule>

    <rule>
      <!-- Regular expressions can use grouping operators to  -->
      <!-- pass parts of the message to the handler.  Not all -->
      <!-- of the handlers use this additional information,   -->
      <!-- but it is available for use if grouping operators  -->
      <!-- are used.                                          -->
      <regexp>pete (\d+) (\d+)</regexp>
      
      <!-- Two handlers are specified for this rule creating  -->
      <!-- a chain.  The first handler is a frequency handler -->
      <!-- which short-circuits the chain unless the message  -->
      <!-- arrival rate is faster than 3 in a period of 10s.  -->
      <!-- In order for a message to be considered the 'same' -->
      <!-- as a previous message, they must have identical    -->
      <!-- values for the second grouping operator because 2  -->
      <!-- was specified for the match_on attribute.          -->
      <handler type="WaitToFrequency" threshold="3" interval="10" match_on="2"/>
      <handler type="Print" file="stdout"/>
    </rule>

    <rule quick="1">

      <regexp>(.*) darrah</regexp>
      
      <!-- Handlers can also specify all of their attributes  -->
      <!-- with the exception of the type attribute, as       -->
      <!-- child elements.  This syntax is generally not used -->
      <!-- because it is not as compact as the former.  If    -->
      <!-- you must specify large blocks of text as a value,  -->
      <!-- this is the preferred format.  Furthermore, is is  -->
      <!-- possible to use CDATA sections when using this     -->
      <!-- format.                                            -->
      <handler type="WaitToCount">
        <threshold>3</threshold>
        <reset>1</reset>
        <match_on>1</match_on>
      </handler>
      <handler type="Print">
        <file>/tmp/test.log</file>
      </handler>
    </rule>

  </logEncapsulator>

  <!-- A configuration may specify many encapsulator elements -->
  <!-- which enable users to use one configuration file and   -->
  <!-- one instance of the program to monitor many log files. -->
  <logEncapsulator name="ITO Monitor">
    <logFile file="test2-1" track="1"/>

    <rule quick="0">
      <regexp>Error (\d+): (.*)</regexp>

      <!-- Another bundled event handler is the Mail handler. -->
      <!-- This enables a user to send an email to one or     -->
      <!-- more addresses.  Of particular interest is the     -->
      <!-- ability to include parts of the original message   -->
      <!-- in the body of the email using the positional      -->
      <!-- parameters.  In the example below, both parameters -->
      <!-- have been specified and included in the body of    -->
      <!-- the email.                                         -->
      <handler type="Mail"
               toaddrs="pete-bitbucket@kazmier.com, pkazmier@ibasis.net"
               fromaddr="pete-bitbucket@kazmier.com"
               subject="Warning! Warning!"
               body="ITO Server \1: \2"/>
    </rule>

    <rule quick="0">
      <regexp>Debug (\d+): (.*)</regexp>

      <!-- Aside from the standard event handlers included in -->
      <!-- this package, 3rd party handlers can be utilized   -->
      <!-- by specifying the event handler in extended form.  -->
      <!-- Extended form includes a package name as well as a -->
      <!-- class name, separated by a colon. In the following -->
      <!-- example, CustomEVentHandlers is a module that must -->
      <!-- be located the python system path and include a    -->
      <!-- class called 'LogPrintEventHandler'.               -->
      <handler type="CustomEventHandlers:LogPrint"/>

      <!-- Included in the standard distribution is another   -->
      <!-- event handler that enables a user to send SNMP     -->
      <!-- traps in response to events.  A trap can be sent   -->
      <!-- to one or more destinations and may include a set  -->
      <!-- of varbinds that should be sent in the trap.       -->
      <handler type="SnmpTrap"
               hosts="mayo.ivanet.net"
               community="public"
               trapoid="1.3.6.1.4.1.121212.1.1">

        <!-- The varbinds are listed one per line in the      -->
        <!-- following format: oid:type:value.  The value is  -->
        <!-- scanned for positional parameters which are then -->
        <!-- replaced with the appropriate text from the      -->
        <!-- original log message (similar to the body of the -->
        <!-- Mail handler above).                             -->
        <varbinds>
          1.3.6.1.4.1.121212.5.5:OCTETSTRING:debugging \2
          1.3.6.1.4.1.121212.5.6:OCTETSTRING:testing \2
          1.3.6.1.4.1.121212.5.7:INTEGER:\1
        </varbinds>
      </handler>
    </rule>

  </logEncapsulator>
</logWrap>
